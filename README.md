# 用JavaScript和神经网络来做手势识别吧

> 本文重点在于如何使用JavaScript做输入数据处理和手势识别，而非神经网络算法本身，如果对神经网络算法感兴趣，请查阅相关文献。

> 当然，你并不是对手势识别感兴趣，你只是想通过本文了解响应式编程或者`rxjs`的一些实践，也欢迎阅读本文，我也是第一次使用`rxjs`，希望能够共同进步。文中如有任何错误，欢迎指出，谢谢！

> JavaScript可以做超多好玩的事。

本实现主要依赖：

- `leapjs` 
- `brain.js`
- `Rxjs`

`leapjs` 是Leap Motion官方提供的JavaScript SDK用来获取手势数据，本实现主要使用了leapjs提供的手掌和手指的位置信息和速度向量来描述手势。

`brain.js` 是一个接口简洁的JavaScript实现神经网络的库，因为原作者已经不维护，现在由志愿者进行管理。本实现主要利用该库进行该库进行数据的训练和识别。同类的库还有ConvNetJS等。

`Rxjs` 是一个响应式编程的工具库，本实现主要利用响应式编程将学习和识别的过程抽象成多个数据流，让逻辑变得清晰可维护。

另外，已经写好的库是使用CoffeeScript写的。但在本文中，为方便大家理解，所有代码均使用JavaScript说明。

## 梳理逻辑

在开始写之前，我们首先梳理一下整个学习和识别过程。

首先，构成手势的数据有哪些？

Leap Motion可以提供给我们的数据特别多，其最基本的单位是帧（frame），其中有手臂、手掌、手指、关节、骨头等等项目繁多的数据，具体数据类型可以看官方文档。我们必须从这些数据中抽取我们需要的，这一部分有很多论文和实验对其进行了研究，抛开学术上的研究不说，我们可以通过日常经验，主观的挑选一些数据。

例如，三维空间中，我们所描述的手势实际上包含两种：

- 手势（例如：左右滑、上下滑、点击等等）
- 姿势（例如：剪刀手、抓紧、放开等等）

【两种图片】

而组成这些手势的主要是手指、手掌，更进一步可以这样说：主要是手掌和手指指尖的位置以及运动轨迹定义了这些手势。所以，我们可以挑选如下数据粗略的代表手势：

``` javascript
frame = {}

```

其次，如何训练？如何识别？

根据`brain.js`文档我们可以得知，训练参数为一个由输入输出匹配构成的数组，其中每个匹配包含一个`input`和一个`output`。

而`input`则是一个单层的键值对，其键无要求，值必须是0~1之间的数值，我们可以将其看成一个0~1范围内数字组成的数组。

`output`则是结果，也是一个单层的键值对，键为任意值，值为0~1的数字，我们可以将键看为某种情况，值看做这种情况的可能性百分比，例如假设得到。

接下来我们就需要将我们之前提到的手势数据转化成训练所需要的数据。


最后，一步一步

我们整理一下整体流程，应该分两部分：

- 生成训练数据
- 进行训练，进行识别

首先，生成训练数据。我们可以不考虑训练的实现，先将所有需要的数据存下来。

1. 开始录制，定义录制时长和录制手势
2. 开始监听leapjs帧
3. 对每一帧进行预处理
4. 录制完毕，对结果进行保存

进行训练主要包括：

1. 将得到的数据进行分析将可能构成手势的帧集合到一起。
2. 将可能是手势的集合进行筛选出可以进行识别的
3. 将可以识别的手势进行格式化预处理
4. 讲格式化后的手势数据转换成长度相同的数组
5. 拼凑训练的参数
6. 训练

训练完成之后，我们可以得到训练好的神经网络，然后就可以进行识别了。

1. 对从leapjs得到的数据进行分析，将可能构成手势的帧聚合提出
2. 筛选（同上2）
3. 格式化预处理（同上3）
4. 生成数组（同上4）
5. 识别数组得到结果


## 响应式编程





## 数据输入

按照上面梳理的内容，我们的数据源应该包含两种：

- 已存储的数据
- `leapjs`提供的每一帧的动态数据

## 数据处理

## 学习

## 识别

## 优化












